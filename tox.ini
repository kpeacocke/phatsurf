[tox]
envlist = py313, lint, coverage

[testenv]
deps =
    pytest
    pytest-cov
    pymongo
    flask
    flask-pymongo
    python-dotenv
commands =
    pytest --cov=app --cov-report=xml:coverage.xml --cov-report=html:htmlcov

[testenv:lint]
description = Run flake8 for linting.
deps =
    flake8
    flake8-bugbear
    flake8-import-order
    flake8-comprehensions
commands =
    flake8 app tests

[testenv:coverage]
description = Generate and display a coverage report.
deps =
    coverage
    pytest-cov
commands =
    coverage report --fail-under=90  # Fail if coverage is below 90%
    coverage html -d htmlcov
    coverage xml -o coverage.xml

[flake8]
max-line-length = 88
exclude = .tox, .venv, .git, __pycache__, build, dist
extend-ignore = E203, W503  # Black-compatible formatting

[coverage:run]
branch = True
source =
    app

[coverage:report]
show_missing = True
skip_covered = True  # Don't show lines fully covered in the report

[coverage:xml]
relative_paths = True
